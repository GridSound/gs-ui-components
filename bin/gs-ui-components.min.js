"use strict";var _Mathsin=Math.sin,_Mathcos=Math.cos,_MathPI=Math.PI,_Mathabs=Math.abs,_Mathmax=Math.max,_Mathmin=Math.min,_Mathceil=Math.ceil;function gsuiBeatLines(a){this.rootElement=a=a||document.createElementNS("http://www.w3.org/2000/svg","svg"),a.setAttribute("preserveAspectRatio","none"),a.classList.add("gsuiBeatLines"),this.elTime=this._newRect(),this.elHLwhen=this._newRect(),this.elHLdur=this._newRect(),this.elTime.setAttribute("class","gsui-currentTime"),this.elHLwhen.setAttribute("class","gsui-hlWhen"),this.elHLdur.setAttribute("class","gsui-hlDuration"),this.elHLwhen.setAttribute("x",0),this.elHLdur.setAttribute("width","10000%"),this.offset=0,this.beatsPerMeasure=this.stepsPerBeat=4,this.steps=[],this.setCurrentTime(0),this.setResolution(256),this.highlight(0,0)}gsuiBeatLines.prototype={setResolution:function(a){this.width=a,this.rootElement.setAttribute("viewBox","0 0 "+a+" 1")},setCurrentTime:function(a){this.currentTime=a,this._timeUpdate()},highlight:function(a,c){this.highlightWhen=a,this.highlightDuration=c,this.elHLwhen.style.display=this.elHLdur.style.display=c?"block":"none",this._hlUpdate()},draw:function(){var a,c,f=this.steps,j=getComputedStyle(this.rootElement),l=parseFloat(j.fontSize),m=this.stepsPerBeat,n=m*this.beatsPerMeasure,o=_Mathceil(this.width/l*m),q=this.offset*m,t=1/m,u=0,v=~~q,z=-(q%1)/m;for(++v,z+=t;f.length<o;)f.push(this._newRect());for(;u<o;++u)a="gsui-"+(v%n?v%m?"step":"beat":"measure"),c=f[u],c.style.display="block",c.setAttribute("x",z+"em"),c.setAttribute("class",a),c.setAttribute("width","gsui-measure"===a?"2px":"1px"),++v,z+=t;for(;u<f.length;++u)f[u].style.display="none";this._timeUpdate(),this._hlUpdate()},_newRect:function(){var a=document.createElementNS("http://www.w3.org/2000/svg","rect");return a.setAttribute("y",0),a.setAttribute("height","1px"),a.setAttribute("width","1px"),this.rootElement.prepend(a),a},_timeUpdate:function(){this.elTime.style.display=this.currentTime>this.offset?"block":"none",this.elTime.setAttribute("x",this.currentTime-this.offset+"em")},_hlUpdate:function(){var a,c=this.highlightDuration;c&&(a=this.highlightWhen-this.offset,0<=a&&this.elHLwhen.setAttribute("width",a+"em"),this.elHLdur.setAttribute("x",a+c+"em"))}};function gsuiEQ(){var a=this._clone(),c=a.querySelector("canvas");this.rootElement=a,this.uiSpectrum=new gsuiSpectrum(c),this.uiSpectrum.setResolution(256)}gsuiEQ.prototype={drawSpectrum:function(a){this.uiSpectrum.draw(a)},_clone:function(){var a=document.createElement("div");return gsuiEQ.template=gsuiEQ.template||this._init(),a.appendChild(document.importNode(gsuiEQ.template.content,!0)),a.removeChild(a.querySelector("*"))},_init:function(){return document.getElementById("gsuiEQ")}};function gsuiOscilloscope(a){this.rootElement=a||document.createElement("canvas"),this.rootElement.classList.add("gsuiOscilloscope"),this.ctx=this.rootElement.getContext("2d"),this.maxValue=0,this.setPinch(0),this.drawBegin(function(c,f,j,l){c.clearRect(0,0,j,l),c.lineWidth=2,c.strokeStyle="#fff"}),this.drawEnd()}gsuiOscilloscope.prototype={setResolution:function(a,c){this.rootElement.width=a,this.rootElement.height=c},clear:function(){this.ctx.clearRect(0,0,this.rootElement.width,this.rootElement.height)},setPinch:function(a){this.pinch=_Mathmax(0,_Mathmin(a,1))},drawBegin:function(a){this.fnBegin=a||function(){}},drawEnd:function(a){this.fnEnd=a||function(){}},draw:function(a){var c,f,j=this.maxValue,l=this.rootElement,m=this.ctx,n=l.width,o=l.height,q=o/2,t=a.length,u=_Mathceil(this.pinch/2*t);if(!1!==this.fnBegin(m,j,n,o)){for(m.beginPath(),j=0,c=0;c<t;++c)f=a[c]/128-1,j=_Mathmax(j,_Mathabs(f)),(c<u||t-u<=c)&&(f*=.5-_Mathcos(_MathPI*(c<u?c:t-1-c)/u)/2),0===c?m.moveTo(0,q+f*q):m.lineTo(c*(n/(t-1)),q+f*q);this.fnEnd(m,j,n,o),m.stroke(),this.maxValue=j}}},window.gsuiPopup={alert:function(a,c){return gsuiPopup._open("alert",a,c)},confirm:function(a,c){return gsuiPopup._open("confirm",a,c)},prompt:function(a,c,f){return gsuiPopup._open("prompt",a,c,f)},close:function(){gsuiPopup.isOpen&&gsuiPopup.elCancel.click()},_init:function(){var a=gsuiPopup,c=document.getElementById("gsuiPopup");a.elRoot=c,a.elWindow=c.querySelector("#gsuiPopup-window"),a.elHeader=c.querySelector("#gsuiPopup-window header"),a.elMsg=c.querySelector(".gsui-msg"),a.elText=c.querySelector(".gsui-text"),a.elCancel=c.querySelector(".gsui-cancel"),a.elOk=c.querySelector(".gsui-ok"),a.elForm=c.querySelector("form"),c.onclick=a.elCancel.onclick=a._cancelClick,a.elForm.onsubmit=a._submit,a.elText.onkeypress=a.elText.onkeydown=a.elText.onkeyup=a.elWindow.onclick=function(f){f.stopPropagation()},a._ready=!0},_open:function(a,c,f,j){var l=gsuiPopup;return l._ready||l._init(),l.isOpen=!0,l.elHeader.textContent=c,l.elMsg.innerHTML=f,l.elText.value=3<arguments.length?j:"",l.elWindow.dataset.gsuiType=l.type=a,l.elWindow.classList.toggle("gsui-nocancel","prompt"!==a&&"confirm"!==a),l.elWindow.classList.toggle("gsui-notext","prompt"!==a),l.elRoot.classList.add("gsui-show"),setTimeout(function(){"prompt"===a?l.elText.select():l.elOk.focus()},250),new Promise(function(m){l.resolve=m}).then(function(m){return l.isOpen=!1,l.elRoot.classList.remove("gsui-show"),m})},_cancelClick:function(){gsuiPopup.resolve("confirm"!==gsuiPopup.type&&("prompt"===gsuiPopup.type?null:void 0))},_submit:function(){return gsuiPopup.resolve("confirm"===gsuiPopup.type||("prompt"===gsuiPopup.type?gsuiPopup.elText.value:void 0)),!1}};function gsuiSlider(){var a=this._clone(),c=a.querySelector("input");this.rootElement=a,this._elInput=c,this._elThumb=a.querySelector(".gsui-thumb"),this._elLine=a.querySelector(".gsui-line"),this._elLineColor=a.querySelector(".gsui-lineColor"),this._elSvg=a.querySelector("svg"),this._elSvgBg=a.querySelector(".gsui-svgBg"),this._elSvgThumb=a.querySelector(".gsui-svgThumb"),this._elSvgLine=a.querySelector(".gsui-svgLine"),this._elSvgLineColor=a.querySelector(".gsui-svgLineColor"),a.onwheel=this._wheel.bind(this),a.onmousedown=this._mousedown.bind(this),this.options({min:0,max:100,step:1,value:50,startFrom:0}),this.linear("x")}gsuiSlider.prototype={linear:function(a){this._circ=!1,this._axeX="x"===a,this.rootElement.classList.remove("gsui-circular","gsui-x","gsui-y"),this.rootElement.classList.add("gsui-linear","gsui-"+a),this._updateVal()},circular:function(){this._circ=!0,this.rootElement.classList.remove("gsui-linear","gsui-x","gsui-y"),this.rootElement.classList.add("gsui-circular"),this._updateVal()},setValue:function(a,c){var f=this._elInput,j=f.value;f.value=a,f.value!==j&&(this._updateVal(),c&&this.oninput&&this.oninput(f.value))},options:function(a){var c,f=this._elInput;for(c in a)this[c]=a[c],"startFrom"!==c&&(f[c]=a[c]);this.startFrom=_Mathmax(f.min,_Mathmin(this.startFrom,f.max)),this._updateVal()},resize:function(a,c){this.rootElement.style.width=a+"px",this.rootElement.style.height=c+"px",this._updateSize(a,c)},resized:function(){var a=this.rootElement.getBoundingClientRect();this._updateSize(a.width,a.height)},_clone:function(){var a=document.createElement("div");return gsuiSlider.template=gsuiSlider.template||this._init(),a.appendChild(document.importNode(gsuiSlider.template.content,!0)),a.removeChild(a.querySelector("*"))},_init:function(){return document.body.addEventListener("mousemove",function(a){gsuiSlider._sliderClicked&&gsuiSlider._sliderClicked._mousemove(a)}),document.body.addEventListener("mouseup",function(a){gsuiSlider._sliderClicked&&gsuiSlider._sliderClicked._mouseup(a)}),document.getElementById("gsuiSlider")},_updateVal:function(){var a,c,f=this._elInput,j=+f.value,l=f.max-f.min,m=(j-f.min)/l,n=(this.startFrom-f.min)/l,o=_Mathabs(m-n),q=_Mathmin(m,n);this.value=j,this._circ?(c=this._elSvgLineColor.style,c.strokeDasharray=o*this._svgLineLen+", 999999",c.transform="rotate("+(90+360*q)+"deg)"):(a=this._elThumb.style,c=this._elLineColor.style,this._axeX?(a.left=100*m+"%",c.left=100*q+"%",c.width=100*o+"%"):(a.bottom=100*m+"%",c.bottom=100*q+"%",c.height=100*o+"%"))},_updateSize:function(a,c){if(a!==this.width||c!==this.height){var f,j=this._elThumb.style,l=this._elLine.style,m=this._axeX?c:a,n=m/2,o=_Mathceil(m/10),q=_Mathmin(a,c);o%2!=m%2&&++o,f=m-~~n-~~n%2,j.marginLeft=j.marginBottom=f/-2+"px",j.width=j.height=f+"px",this._axeX?(l.height=o+"px",l.marginTop=o/-2+"px",l.left=l.right=n+"px"):(l.width=o+"px",l.marginLeft=o/-2+"px",l.top=l.bottom=n+"px"),this.width=a,this.height=c,this._svgLineLen=q/3,this._elSvg.setAttribute("viewBox","0 0 "+q+" "+q),this._elSvgBg.setAttribute("r",q/2),this._elSvgThumb.setAttribute("r",q/3.2),this._elSvgLine.setAttribute("r",this._svgLineLen),this._elSvgLineColor.setAttribute("r",this._svgLineLen),this._elSvgLine.style.strokeWidth=this._elSvgLineColor.style.strokeWidth=q/10,this._svgLineLen*=2*_MathPI}},_wheel:function(a){var c=0<a.deltaY?-1:1,f=this._elInput;this.setValue(+f.value+f.step*(this.axeX?-c:c),!0)},_mousedown:function(){var c=this._elInput,f=this._elLine.getBoundingClientRect(),j=this._circ?this._svgLineLen:this._axeX?f.width:f.height;this._prval=c.value,this._pxval=(c.max-c.min)/j,this._pxmoved=0,gsuiSlider._sliderClicked=this,this.rootElement.requestPointerLock()},_mouseup:function(){document.exitPointerLock(),delete gsuiSlider._sliderClicked,this._prval!==this._elInput.value&&this.onchange&&this.onchange(this._elInput.value)},_mousemove:function(a){var c=this._circ||!this._axeX?-a.movementY:a.movementX,f=this._elInput,j=(f.max-f.min)/5,l=+this._prval+(this._pxmoved+c)*this._pxval;f.min-j<l&&l<+f.max+j&&(this._pxmoved+=c),this.setValue(l,!0)}};function gsuiSpanEditable(){this.rootElement=this._clone(),this.span=this.rootElement.querySelector("span"),this.input=this.rootElement.querySelector("input"),this.rootElement.ondblclick=this._dblclick.bind(this),this.input.onblur=this._blur.bind(this),this.input.onkeydown=this._keydown.bind(this),this.setPlaceholder(""),this.setValue("")}gsuiSpanEditable.prototype={setValue:function(a,c){a=a.trim(),a!==this.value&&(this.value=a,this.rootElement.classList.toggle("gsui-empty",!a),this.span.textContent=a||this.placeholder,c&&this.onchange&&this.onchange(a))},setPlaceholder:function(a){this.placeholder=a.trim(),this.value||(this.span.textContent=this.placeholder)},_clone:function(){var a=document.createElement("div"),c=gsuiSpanEditable.template;return gsuiSpanEditable.template=c=c||document.getElementById("gsuiSpanEditable"),a.appendChild(document.importNode(c.content,!0)),a.removeChild(a.querySelector("*"))},_dblclick:function(){this.input.value=this.value,this.rootElement.classList.add("gsui-editing"),this.input.focus(),this.input.select()},_blur:function(a){this._esc||(this.setValue(a.target.value,!0),this.rootElement.classList.remove("gsui-editing")),this._esc=!1},_keydown:function(a){a.stopPropagation(),(13===a.keyCode||27===a.keyCode)&&(this._esc=27===a.keyCode,!this._esc&&this.setValue(a.target.value,!0),this.rootElement.classList.remove("gsui-editing"))}};function gsuiSpectrum(a){this.rootElement=a||document.createElement("canvas"),this.rootElement.classList.add("gsuiSpectrum"),this.ctx=this.rootElement.getContext("2d"),this.colors=[[5,2,20],[8,5,30],[15,7,50],[75,7,35],[80,0,0],[180,0,0],[200,25,10],[200,128,10],[200,200,20]]}gsuiSpectrum.prototype={setResolution:function(a){this.rootElement.width=a,this.rootElement.height=1},clear:function(){this.ctx.clearRect(0,0,this.rootElement.width,this.rootElement.height)},draw:function(a){var c,f,j,l,m,n,o,q=0,t=0,u=this.rootElement,v=this.ctx,z=u.width,A=u.height,B=a.length;for((this._datalen!==B||this._width!==z)&&this._calcWidths(a,this._datalen=B,this._width=z),o=this._widths;t<B;++t)c=1-_Mathcos(a[t]/255*_MathPI/2),.05>c?(l=4+10*c,m=4+10*c,n=5+20*c):(.08>c?(j=0,c/=.08):.15>c?(j=1,c/=.15):.17>c?(j=2,c/=.17):.25>c?(j=3,c/=.25):.3>c?(j=4,c/=.3):.4>c?(j=5,c/=.4):.6>c?(j=6,c/=.6):.8>c?(j=7,c/=.8):j=8,f=this.colors[j],l=f[0]*c,m=f[1]*c,n=f[2]*c),v.fillStyle="rgb("+~~l+","+~~m+","+~~n+")",v.fillRect(q,0,o[t],A),q+=o[t]},_calcWidths:function(a,c,f){var j,l=0,m=Array(c);for(j=0;j<c;++j)l+=m[j]=Math.log(c/(j+1));for(j=0;j<c;++j)m[j]=m[j]/l*f;this._widths=m}};function gsuiToggle(){var a=this._clone(),c=a.querySelector("input");this.rootElement=a,this._circCL=a.querySelector(".gsui-circle").classList,this.checked=!1,a.oncontextmenu=function(){return!1},a.onmousedown=this._mousedown.bind(this)}gsuiToggle.prototype={check:function(){this._set(!0)},uncheck:function(){this._set(!1)},toggle:function(a){this._set(arguments.length?!!a:!this.checked)},_clone:function(){var a=document.createElement("div");return gsuiToggle.template=gsuiToggle.template||document.getElementById("gsuiToggle"),a.appendChild(document.importNode(gsuiToggle.template.content,!0)),a.removeChild(a.querySelector("*"))},_set:function(a,c){a!==this.checked&&(this.checked=a,this._circCL.toggle("gsui-on",a),c&&this.onchange&&this.onchange(a))},_mousedown:function(a){0===a.button?this._set(!this.checked,!0):2===a.button&&this.onmousedownright&&this.onmousedownright()}};function gsuiWave(a){var c="http://www.w3.org/2000/svg";this.rootElement=a||document.createElementNS(c,"svg"),this.rootElement.setAttribute("preserveAspectRatio","none"),this.rootElement.classList.add("gsuiWave"),this.polyline=this.rootElement.querySelector("polyline"),this.polyline||(this.polyline=document.createElementNS(c,"polyline"),this.rootElement.appendChild(this.polyline)),this.type="sine",this.frequency=1,this.attack=this.amplitude=0}gsuiWave.sine=function(a){return _Mathsin(a)},gsuiWave.square=function(a){return 0<_Mathsin(a)?1:-1},gsuiWave.sawtooth=function(a){return a/=2*_MathPI,2*(a-Math.floor(a+.5))},gsuiWave.triangle=function(a){return 2*_Mathabs(gsuiWave.sawtooth(a+_MathPI/2))-1},gsuiWave.prototype={setResolution:function(a,c){this.width=a,this.height=c,this.rootElement.setAttribute("viewBox","0 0 "+a+" "+c)},draw:function(){for(var a=0,c=this.width,f=this.height/2,j=-this.amplitude*f,l=c*this.attack,m=2*_MathPI/c*this.frequency,n=gsuiWave[this.type],o=new Float32Array(2*c);a<c;++a)o[2*a]=a,o[2*a+1]=f+n(a*m)*j*(a<l?a/l:1);this.polyline.setAttribute("points",o.join(" "))}};function gsuiWaveform(a){var c="http://www.w3.org/2000/svg";this.rootElement=a||document.createElementNS(c,"svg"),this.rootElement.setAttribute("preserveAspectRatio","none"),this.rootElement.classList.add("gsuiWaveform"),this.polygon=this.rootElement.querySelector("polygon"),this.polygon||(this.polygon=document.createElementNS(c,"polygon"),this.rootElement.appendChild(this.polygon))}gsuiWaveform.prototype={setResolution:function(a,c){this.width=a,this.height=c,this.rootElement.setAttribute("viewBox","0 0 "+a+" "+c)},clear:function(){this.polygon.removeAttribute("points")},drawBuffer:function(a,c,f){var j=a.getChannelData(0),l=1<a.numberOfChannels?a.getChannelData(1):j;c=c||0,this.draw(j,l,a.duration,c,f||a.duration-c)},draw:function(a,c,f,j,l){var m,n=this.width,o=this.height,q=o/2,t=a.length,u=~~(j/f*t),v=l/f*t/n,z="0,"+(q+a[u]*q),A="0,"+(q+c[u]*q),B=~~_Mathmax(1,v/100);for(m=1;m<n;++m){for(var C=Infinity,D=-Infinity,E=~~(u+(m-1)*v),F=E+v;E<F;E+=B)C=_Mathmin(C,a[E],c[E]),D=_Mathmax(D,a[E],c[E]);1>_Mathabs(D-C)*q&&(D+=1/o,C-=1/o),z+=" "+m+","+(q+C*q),A=m+","+(q+D*q)+" "+A}this.polygon.setAttribute("points",z+" "+A)}};
